<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI全流程产研平台</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="top-navbar">
        <div class="nav-content">
            <div class="logo">🚀 AI全流程产研平台</div>
            <div class="project-info">
                <span class="project-label">当前项目：</span>
                <span id="current-project-name" class="project-name" contenteditable="true">未命名产品 v1.0</span>
            </div>
            <div class="nav-right">
                <button class="btn-icon" onclick="resetProject()" title="新建项目">➕</button>
                <div class="api-status" id="api-status-indicator" title="API状态">🟢</div>
            </div>
        </div>
    </nav>

    <!-- 主容器 -->
    <div class="main-container">
        <!-- 左侧流水线导航 -->
        <aside class="pipeline-sidebar">
            <div class="pipeline-title">产品流水线</div>
            
            <div class="pipeline-steps">
                <!-- 阶段1：需求 -->
                <div class="step-item active" onclick="switchStage('requirement')" id="step-requirement">
                    <div class="step-icon">📝</div>
                    <div class="step-content">
                        <div class="step-title">需求定义</div>
                        <div class="step-desc">沟通与确认</div>
                    </div>
                    <div class="step-status" id="status-requirement">进行中</div>
                </div>
                
                <div class="step-line"></div>

                <!-- 阶段2：MVP -->
                <div class="step-item" onclick="switchStage('mvp')" id="step-mvp">
                    <div class="step-icon">⚡️</div>
                    <div class="step-content">
                        <div class="step-title">MVP搭建</div>
                        <div class="step-desc">生成核心功能</div>
                    </div>
                    <div class="step-status" id="status-mvp">待开始</div>
                </div>

                <div class="step-line"></div>

                <!-- 阶段3：UI优化 -->
                <div class="step-item" onclick="switchStage('ui')" id="step-ui">
                    <div class="step-icon">🎨</div>
                    <div class="step-content">
                        <div class="step-title">UI/UX优化</div>
                        <div class="step-desc">视觉与交互升级</div>
                    </div>
                    <div class="step-status" id="status-ui">待开始</div>
                </div>

                <div class="step-line"></div>

                <!-- 阶段4：质量验收 -->
                <div class="step-item" onclick="switchStage('qa')" id="step-qa">
                    <div class="step-icon">🔍</div>
                    <div class="step-content">
                        <div class="step-title">质量验收</div>
                        <div class="step-desc">三维走查与修复</div>
                    </div>
                    <div class="step-status" id="status-qa">待开始</div>
                </div>

                <div class="step-line"></div>

                <!-- 阶段5：数据复盘 -->
                <div class="step-item" onclick="switchStage('data')" id="step-data">
                    <div class="step-icon">🚀</div>
                    <div class="step-content">
                        <div class="step-title">上线复盘</div>
                        <div class="step-desc">数据效果分析</div>
                    </div>
                    <div class="step-status" id="status-data">待开始</div>
                </div>
            </div>
        </aside>

        <!-- 主工作台 -->
        <main class="workspace">
            <!-- 阶段1：需求定义 -->
            <div id="stage-requirement" class="stage-section active">
                <div class="workspace-header">
                    <h2>📝 需求定义</h2>
                    <p>清晰的需求是优秀产品的第一步。请描述你的产品构想，AI 将协助你完善。</p>
                </div>
                <div class="workspace-content">
                    <div class="input-group">
                        <label class="input-label">产品构想 / 需求描述</label>
                        <textarea id="req-input" class="input-textarea" placeholder="例如：我想做一个在线待办事项应用，支持任务分类、优先级排序，并且有一个数据看板统计完成率..."></textarea>
                    </div>
                    <div class="action-bar">
                        <button class="btn btn-primary" onclick="confirmRequirement()">✅ 确认需求并进入开发</button>
                    </div>
                </div>
            </div>

            <!-- 阶段2：MVP搭建 -->
            <div id="stage-mvp" class="stage-section">
                <div class="workspace-header">
                    <h2>⚡️ MVP 快速搭建</h2>
                    <p>基于确认的需求，AI 正在生成最小可行性产品（MVP）代码。</p>
                </div>
                <div class="workspace-content split-view">
                    <div class="view-left">
                        <div class="code-preview-header">
                            <span>当前版本：v1.0 (MVP)</span>
                            <button class="btn-sm" onclick="regenerateMVP()">🔄 重新生成</button>
                        </div>
                        <div id="mvp-preview" class="preview-container empty-state">
                            <div class="empty-icon">⚙️</div>
                            <p>点击下方按钮开始生成 MVP</p>
                        </div>
                    </div>
                    <div class="view-right">
                        <div class="action-panel">
                            <h3>执行操作</h3>
                            <button class="btn btn-primary full-width" onclick="generateMVP()">⚡️ 生成 MVP 代码</button>
                            <div class="log-panel" id="mvp-logs"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段3：UI/UX优化 -->
            <div id="stage-ui" class="stage-section">
                <div class="workspace-header">
                    <h2>🎨 交互与 UI 优化</h2>
                    <p>在 MVP 基础上，注入设计规范，提升视觉体验和交互流畅度。</p>
                </div>
                <div class="workspace-content split-view">
                    <div class="view-left">
                        <div class="code-preview-header">
                            <span>当前版本：v2.0 (UI Optimized)</span>
                            <div class="tab-group">
                                <button class="tab-btn active" onclick="switchPreview('ui', 'desktop')">🖥 桌面端</button>
                                <button class="tab-btn" onclick="switchPreview('ui', 'mobile')">📱 移动端</button>
                            </div>
                        </div>
                        <div id="ui-preview" class="preview-container empty-state">
                            <div class="empty-icon">🎨</div>
                            <p>等待 MVP 构建完成...</p>
                        </div>
                    </div>
                    <div class="view-right">
                        <div class="action-panel">
                            <h3>优化方向</h3>
                            <textarea id="ui-refinement" class="input-textarea-sm" placeholder="例如：使用蓝色系主色调，增加卡片阴影，按钮改为圆角..."></textarea>
                            <button class="btn btn-primary full-width" onclick="optimizeUI()">🎨 执行 UI 升级</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段4：质量验收 (三维走查) -->
            <div id="stage-qa" class="stage-section">
                <div class="workspace-header">
                    <h2>🔍 质量验收工作台</h2>
                    <p>三维走查：代码质量、功能逻辑、用户体验，全方位保障产品质量。</p>
                </div>
                <div class="workspace-content">
                    <div class="qa-dashboard">
                        <!-- 维度1：代码技术 -->
                        <div class="qa-column">
                            <div class="qa-column-header code-header">
                                <span class="qa-icon">🐛</span>
                                <h3>代码/技术走查</h3>
                            </div>
                            <div class="qa-body" id="qa-code-body">
                                <div class="empty-qa">待执行走查...</div>
                            </div>
                            <div class="qa-footer">
                                <button class="btn-sm full-width" onclick="autoFixCode()" disabled id="btn-fix-code">🛠 一键修复 Bug</button>
                            </div>
                        </div>

                        <!-- 维度2：功能逻辑 -->
                        <div class="qa-column">
                            <div class="qa-column-header logic-header">
                                <span class="qa-icon">⚙️</span>
                                <h3>功能/逻辑走查</h3>
                            </div>
                            <div class="qa-body" id="qa-logic-body">
                                <div class="empty-qa">待执行走查...</div>
                            </div>
                            <div class="qa-footer">
                                <button class="btn-sm full-width" onclick="fixLogic()" disabled id="btn-fix-logic">🧠 修复逻辑问题</button>
                            </div>
                        </div>

                        <!-- 维度3：体验/UX -->
                        <div class="qa-column">
                            <div class="qa-column-header ux-header">
                                <span class="qa-icon">👁️</span>
                                <h3>体验/UX走查</h3>
                            </div>
                            <div class="qa-body" id="qa-ux-body">
                                <div class="empty-qa">待执行走查...</div>
                            </div>
                            <div class="qa-footer">
                                <button class="btn-sm full-width" onclick="feedbackToUI()" disabled id="btn-feedback-ui">↩️ 反馈给 UI 优化</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-bar centered">
                        <button class="btn btn-primary" onclick="runFullQA()">🚀 开始全方位走查</button>
                    </div>
                </div>
            </div>

            <!-- 阶段5：数据复盘 -->
            <div id="stage-data" class="stage-section">
                <div class="workspace-header">
                    <h2>🚀 上线与数据复盘</h2>
                    <p>产品上线后，通过数据分析验证产品效果。</p>
                </div>
                <div class="workspace-content">
                    <div class="upload-area-large" id="data-upload-area" onclick="document.getElementById('data-file-input').click()">
                        <div class="upload-icon">📊</div>
                        <div class="upload-text">上传运营数据 (Excel)</div>
                        <p class="upload-hint">AI 将自动分析用户行为、留存率及核心指标</p>
                        <input type="file" id="data-file-input" class="file-input" multiple accept=".xlsx,.xls" onchange="handleDataFiles(event)">
                    </div>
                    <div id="data-file-list" class="file-list"></div>
                    <div id="data-report" class="report-container hidden"></div>
                    <div class="action-bar centered">
                        <button class="btn btn-primary" id="analyze-btn" onclick="startDataAnalysis()" disabled>📈 生成复盘报告</button>
                    </div>
                </div>
            </div>

            <!-- 全局 Loading 遮罩 -->
            <div id="global-loading" class="global-loading hidden">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <h3 id="loading-title">AI 正在思考...</h3>
                    <p id="loading-text">正在分析需求上下文...</p>
                </div>
            </div>
        </main>
    </div>

    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
